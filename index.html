<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Chords</title>
    <meta name="viewport" content="width=device-width">
    <script src="envelope.js"></script>
    <script src="voice.js"></script>
    <script src="synth.js"></script>
    <script src="freeverb.js"></script>
    <script src="script.js"></script>
    <script src="elm.js"></script>
    <style>
    button {
      font: inherit;
      line-height: initial;
    }
    input {
      font: inherit;
      margin: 0;
      line-height: initial;
      box-sizing: border-box;
    }
    .radio {
      position: relative;
      display: inline-grid;
      grid-template-columns: auto 1px auto 1px auto;
    }
    .radio > button {
      padding: 2px 3px;
      border: 1px solid darkgray;
      background: #e0e0e0;
      box-shadow: inset 0.2em 1.2em 0.7em -0.7em rgba(255, 255, 255, 1);
      transition-property: background-color, box-shadow;
      transition-duration: 0.2s;
      grid-row: 1;
    }
    .radio > button:first-of-type {
      box-shadow: inset 0.7em 1.2em 0.7em -0.7em rgba(255, 255, 255, 1);
      border-radius: 0.22em 0 0 0.22em;
      grid-column: 1 / 3;
    }
    .radio > button:nth-of-type(2) {
      grid-column: 2 / 5;
    }
    .radio > button:last-of-type {
      border-radius: 0 0.22em 0.22em 0;
      grid-column: 4 / 6;
    }
    .radio > button:first-of-type > span {
      border-radius: 0.22em 0 0 0.22em;
      grid-column: 1 / 3;
    }
    .radio > button:nth-of-type(2) > span {
      grid-column: 2 / 5;
    }
    .radio > button:last-of-type > span {
      border-radius: 0 0.22em 0.22em 0;
      grid-column: 4 / 6;
    }
    .radio > button:hover {
      background: lightblue;
      box-shadow: inset 0.2em 1.2em 0.7em -0.7em rgba(255, 255, 255, 0.7);
    }
    .radio > button:first-of-type:hover {
      box-shadow: inset 0.7em 1.2em 0.7em -0.7em rgba(255, 255, 255, 0.7);
    }
    .radio > button:active {
      background: lightskyblue;
      box-shadow: inset 0.2em 1.2em 0.7em -0.7em rgba(255, 255, 255, 0.5);
      transition-duration: 0s;
    }
    .radio > button:first-of-type:active {
      box-shadow: inset 0.7em 1.2em 0.7em -0.7em rgba(255, 255, 255, 0.5);
    }
    .radio > button.chosen {
      background: lightskyblue;
      box-shadow: inset 0.2em 1.2em 0.7em -0.7em rgba(255, 255, 255, 0.5);
      transition-duration: 0s;
    }
    .radio > button:first-of-type.chosen {
      box-shadow: inset 0.7em 1.2em 0.7em -0.7em rgba(255, 255, 255, 0.5);
    }
    .radio > button > span {
      position: absolute;
      pointer-events: none;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      border: 1px solid;
      opacity: 0;
      transition-property: opacity;
      transition-duration: inherit;
    }
    .radio > button > span:first-of-type {
      border-color: dodgerblue;
      z-index: 1;
    }
    .radio > button:hover > span:first-of-type {
      opacity: 1;
    }
    .radio > button > span:last-of-type {
      border-color: gray;
    }
    .radio > button:active > span:first-of-type {
      opacity: 0;
    }
    .radio > button:active > span:last-of-type {
      opacity: 1;
    }
    .radio > button.chosen > span:first-of-type {
      opacity: 0;
    }
    .radio > button.chosen > span:last-of-type {
      opacity: 1;
    }
    </style>
  </head>
  <body>
    <div id="main"></div>
    <script>
      function isUndoOrRedo(ev) {
        return (ev.which == 90 || (ev.which == 89 && !ev.shiftKey)) &&
          ev.ctrlKey + ev.metaKey == 1 &&
          !ev.altKey;
      }

      function isUndoNotRedo(ev) {
        return ev.which == 90 && !ev.shiftKey;
      }

      function lockCatcher(ev) {
        if (isUndoOrRedo(ev)) {
          let catcher = ev.target;
          if (catcher.lockedValue != null) {
            ev.preventDefault();
          } else {
            let undo = isUndoNotRedo(ev);
            let lockedValue = undo ? catcher.undoValue : catcher.redoValue;
            if (catcher.value == lockedValue) {
              catcher.lockedValue = lockedValue;
              let port = undo ? app.ports.undo : app.ports.redo;
              catcher.timeout = setTimeout(
                function() {
                  if (catcher.lockedValue != null) {
                    catcher.timeout = 0;
                    port.send(null);
                  }
                },
                5
              );
            }
          }
        }
      }

      function unlockCatcher(ev) {
        let catcher = ev.target;
        if (catcher.timeout && catcher.value != catcher.lockedValue) {
          catcher.lockedValue = null;
          clearTimeout(catcher.timeout);
          catcher.timeout = 0;
        }
      }

      var app = Elm.Main.fullscreen();
      app.ports.changeAudio.subscribe(changeAudio);
    </script>
  </body>
</html>
